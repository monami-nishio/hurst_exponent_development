---
title: "Piper Functional Maturity"
author: "Cassidy McDermott"
date: "8/19/2023"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
devtools::install_github("WinVector/WVPlots")
library(WVPlots)
library(clue)
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggExtra)
library(cowplot)
theme_set(theme_cowplot())
library(corrplot)
library(visreg)
library(ggcorrplot)
library(ggseg3d)
library(ggsegSchaefer)
library(ggsegYeo2011)
library(psych)
library(nlme)
library(mgcv)
library(gratia)

income_H_low <- read.csv("../derivatives/childhood/H_income_low.csv") 
income_H_high <- read.csv("../derivatives/childhood/H_income_high.csv") 
income_part_low <- read.csv("../derivatives/childhood/part_income_low.csv") 
income_part_high <- read.csv("../derivatives/childhood/part_income_high.csv") 

# Figure6D
colfunc <- colorRampPalette(c("gold","purple"))(2)
postscript('../figures/Fig6D.eps') 
model_low <- gam(scale(rowMeans(income_H_low[1:200])) ~ s(age_scan, k=3) + male + t1_rating_avg, data = income_H_low)
model_high <- gam(scale(rowMeans(income_H_high[1:200])) ~ s(age_scan, k=3) + male + t1_rating_avg, data = income_H_high)
plot(model_high, se=TRUE, residuals=FALSE, shade=TRUE, col=colfunc[1], shade.col=colfunc[1], ylim=c(-1,1), xlim=c(4,11), ylab='Hurst Exponent (z-scored)', xlab='Age')
par(new=T)
plot(model_low, se=TRUE, residuals=FALSE, shade=TRUE, col=colfunc[1], shade.col=colfunc[1], ylim=c(-1,1), xlim=c(4,11), ylab='', xlab='', lty=2)
dev.off()

# Figure6E
postscript('../figures/Fig6E.eps') 
model_low <- gam(scale(rowMeans(income_H_low[201:400])) ~ s(age_scan, k=3) + male + t1_rating_avg, data = income_H_low)
model_high <- gam(scale(rowMeans(income_H_high[201:400])) ~ s(age_scan, k=3) + male + t1_rating_avg, data = income_H_high)
plot(model_high, se=TRUE, residuals=FALSE, shade=TRUE, col=colfunc[2], shade.col=colfunc[2], ylim=c(-1,1),  xlim=c(4,11),ylab='Hurst Exponent (z-scored)', xlab='Age')
par(new=T)
plot(model_low, se=TRUE, residuals=FALSE, shade=TRUE, col=colfunc[2], shade.col=colfunc[2], ylim=c(-1,1),  xlim=c(4,11),ylab='', xlab='', lty=2)
dev.off()

# Figure6F
colfunc <- colorRampPalette(c("gold","purple"))(2)
postscript('../figures/Fig6F.eps') 
model_low <- gam(scale(rowMeans(income_part_low[1:200])) ~ s(age_scan, k=3) + male + t1_rating_avg, data = income_part_low)
model_high <- gam(scale(rowMeans(income_part_high[1:200])) ~ s(age_scan, k=3) + male + t1_rating_avg, data = income_part_high)
plot(model_high, se=TRUE, residuals=FALSE, shade=TRUE, col=colfunc[1], shade.col=colfunc[1], ylim=c(-1,1), xlim=c(4,11), ylab='Participation Coefficient (z-scored)', xlab='Age')
par(new=T)
plot(model_low, se=TRUE, residuals=FALSE, shade=TRUE, col=colfunc[1], shade.col=colfunc[1], ylim=c(-1,1), xlim=c(4,11), ylab='', xlab='', lty=2)
dev.off()

# Figure6G
postscript('../figures/Fig6G.eps') 
model_low <- gam(scale(rowMeans(income_part_low[201:400])) ~ s(age_scan, k=3) + male + t1_rating_avg, data = income_part_low)
model_high <- gam(scale(rowMeans(income_part_high[201:400])) ~ s(age_scan, k=3) + male + t1_rating_avg, data = income_part_high)
plot(model_high, se=TRUE, residuals=FALSE, shade=TRUE, col=colfunc[2], shade.col=colfunc[2], ylim=c(-1,1),  xlim=c(4,11),ylab='Participation Coefficient (z-scored)', xlab='Age')
par(new=T)
plot(model_low, se=TRUE, residuals=FALSE, shade=TRUE, col=colfunc[2], shade.col=colfunc[2], ylim=c(-1,1),  xlim=c(4,11),ylab='', xlab='', lty=2)
dev.off()
```