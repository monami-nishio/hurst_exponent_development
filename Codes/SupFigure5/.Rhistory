knitr::opts_chunk$set(echo = TRUE)
devtools::install_github("WinVector/WVPlots")
library(WVPlots)
library(clue)
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggExtra)
library(cowplot)
theme_set(theme_cowplot())
library(corrplot)
library(visreg)
library(ggcorrplot)
library(ggseg3d)
library(ggseg)
library(ggsegSchaefer)
library(ggsegYeo2011)
library(psych)
library(nlme)
library(mgcv)
library(gratia)
load(file="../../Dataset/childhood/atlas/schaefer17_400_3d.RData")
lh_label <- schaefer17_400_3d$ggseg_3d[[1]]['region'][2:201,1:1]
rh_label <- schaefer17_400_3d$ggseg_3d[[2]]['region'][2:201,1:1]
label <- rbind(lh_label, rh_label)
age_H <- read.csv("../../Derivatives/childhood/part_motion_1mm.csv")
age_H_sorted <- read.csv("../../Derivatives/childhood/part_sorted_motion_1mm.csv")
concat <- read.csv('../../Derivatives/childhood/original_motion_1mm.csv')
brod <- read.csv('../../Derivatives/childhood/part_brodmann.csv')
age_H <- age_H[age_H$sub!='CBPD0015',]
age_H <- age_H[age_H$sub!='CBPD0247',]
age_H_sorted <- age_H_sorted[age_H_sorted$sub!='CBPD0015',]
age_H_sorted <- age_H_sorted[age_H_sorted$sub!='CBPD0247',]
k=3
schaefer_H <- data.frame(age=1:400)
pvalue <- data.frame(age=1:400)
for (n in 1:400){
col <- colnames(age_H)[n]
gam.model <- gam(age_H[[col]] ~ s(age_scan, k=k) + male + meanFD, data = age_H)
gam.nullmodel <- gam(age_H[[col]] ~ male + meanFD, data = age_H)
derv <- derivatives(gam.model, interval = "simultaneous", unconditional = F)
pvalue$age[n] <- anova.gam(gam.nullmodel, gam.model, test='Chisq')$`Pr(>Chi)`[2]
### effect size
sse.model <- sum((gam.model$y - gam.model$fitted.values)^2)
sse.nullmodel <- sum((gam.nullmodel$y - gam.nullmodel$fitted.values)^2)
partialRsq <- (sse.nullmodel - sse.model)/sse.nullmodel
### effect direction
mean.derivative <- mean(derv[['.derivative']])
if(mean.derivative < 0){ #if the average derivative is less than 0, make the effect size estimate negative
partialRsq <- partialRsq*-1}
schaefer_H$age[n] <- partialRsq
}
correctedpvalue <- data.frame(age=1:400)
correctedpvalue$age <- p.adjust(pvalue$age, method=c("fdr")) < 0.05
pvalue$age <- pvalue$age < 0.05
schaefer_H_extractp <- schaefer_H
schaefer_H_extractp[pvalue==FALSE] <- NA
schaefer_H_extractp <- cbind(schaefer_H_extractp, label)
schaefer_H_extractpadj <- schaefer_H
schaefer_H_extractpadj[correctedpvalue==FALSE] <- NA
schaefer_H_extractpadj <- cbind(schaefer_H_extractpadj, label)
# Figure 3C
schaefer_H_extractp$plateau <- increase$age
# Figure 3C
ggseg(schaefer_H_extractp, atlas = schaefer17_400, mapping = aes(fill = age),
position = "stacked") +
scale_fill_gradientn(colours=c("blue", 'white', "red"), name = bquote(age_effect), values = scales::rescale(c(-0.5, -0.05, 0, 0.05, 0.5)), limit=c(-0.3, 0.3)) + theme_brain(text.size=16)
ggsave(filename ='Fig3C.eps', device = "pdf", dpi = 500)
# Figure 3C
ggseg(schaefer_H_extractpadj, atlas = schaefer17_400, mapping = aes(fill = age),
position = "stacked") +
scale_fill_gradientn(colours=c("blue", 'white', "red"), name = bquote(age_effect), values = scales::rescale(c(-0.5, -0.05, 0, 0.05, 0.5)), limit=c(-0.3, 0.3)) + theme_brain(text.size=16)
ggsave(filename ='Fig3C.eps', device = "pdf", dpi = 500)
# Figure 3C
ggseg(schaefer_H_extractpadj, atlas = schaefer17_400, mapping = aes(fill = age),
position = "stacked") +
scale_fill_gradientn(colours=c("blue", 'white', "red"), name = bquote(age_effect), values = scales::rescale(c(-0.5, -0.05, 0, 0.05, 0.5)), limit=c(-0.5, 0.5)) + theme_brain(text.size=16)
ggsave(filename ='Fig3C.eps', device = "pdf", dpi = 500)
# Figure 3C
ggseg(schaefer_H_extractpadj, atlas = schaefer17_400, mapping = aes(fill = age),
position = "stacked") +
scale_fill_gradientn(colours=c("blue", 'white', "red"), name = bquote(age_effect), values = scales::rescale(c(-0.5, -0.05, 0, 0.05, 0.5))) + theme_brain(text.size=16)
ggsave(filename ='Fig3C.eps', device = "pdf", dpi = 500)
# Figure 3C
ggseg(schaefer_H_extractpadj, atlas = schaefer17_400, mapping = aes(fill = age),
position = "stacked") +
scale_fill_gradientn(colours=c("blue", 'white', "red"), name = bquote(age_effect), values = scales::rescale(c(-0.5, -0.05, 0, 0.05, 0.5)), limit=c(-0.3, 0.3)) + theme_brain(text.size=16)
ggsave(filename ='Fig3C.eps', device = "pdf", dpi = 500)
knitr::opts_chunk$set(echo = TRUE)
library(clue)
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(cowplot)
theme_set(theme_cowplot())
library(corrplot)
library(visreg)
library(ggseg)
library(ggcorrplot)
library(ggseg3d)
library(ggsegSchaefer)
library(ggsegYeo2011)
library(psych)
library(nlme)
library(mgcv)
load(file="../../Dataset/childhood/atlas/schaefer17_400_3d.RData")
lh_label <- schaefer17_400_3d$ggseg_3d[[1]]['region'][2:201,1:1]
rh_label <- schaefer17_400_3d$ggseg_3d[[2]]['region'][2:201,1:1]
label  <-rbind(lh_label, rh_label)
child <- read.csv('../../Derivatives/childhood/original_motion_1mm.csv')
child['region'] <- label
indv <- read.csv('../../Derivatives/childhood/indv_motion_1mm.csv')
indv05 <- read.csv('../../Derivatives/childhood/indv_motion_0.5mm.csv')
concat <- read.csv('../../Derivatives/childhood/original_motion_1mm.csv')
concat05 <- read.csv('../../Derivatives/childhood/original_motion_0.5mm.csv')
age_H <- read.csv("../../Derivatives/childhood/hurst_motion_1mm.csv")
age_part <- read.csv("../../Derivatives/childhood/part_motion_1mm.csv")
knitr::opts_chunk$set(echo = TRUE)
library(clue)
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(cowplot)
theme_set(theme_cowplot())
library(corrplot)
library(visreg)
library(ggseg)
library(ggcorrplot)
library(ggseg3d)
library(ggsegSchaefer)
library(ggsegYeo2011)
library(psych)
library(nlme)
library(mgcv)
load(file="../../Dataset/childhood/atlas/schaefer17_400_3d.RData")
lh_label <- schaefer17_400_3d$ggseg_3d[[1]]['region'][2:201,1:1]
rh_label <- schaefer17_400_3d$ggseg_3d[[2]]['region'][2:201,1:1]
label  <-rbind(lh_label, rh_label)
child <- read.csv('../../Derivatives/childhood/original_motion_1mm.csv')
child['region'] <- label
adult <- read.csv('../../Derivatives/adult/original_motion_1mm.csv')
adult['region'] <- label
indv <- read.csv('../../Derivatives/childhood/indv_motion_1mm.csv')
indv05 <- read.csv('../../Derivatives/childhood/indv_motion_0.5mm.csv')
concat <- read.csv('../../Derivatives/childhood/original_motion_1mm.csv')
concat05 <- read.csv('../../Derivatives/childhood/original_motion_0.5mm.csv')
age_H <- read.csv("../../Derivatives/childhood/hurst_motion_1mm.csv")
age_part <- read.csv("../../Derivatives/childhood/part_motion_1mm.csv")
knitr::opts_chunk$set(echo = TRUE)
library(clue)
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(cowplot)
theme_set(theme_cowplot())
library(corrplot)
library(visreg)
library(ggseg)
library(ggcorrplot)
library(ggseg3d)
library(ggsegSchaefer)
library(ggsegYeo2011)
library(psych)
library(nlme)
library(mgcv)
load(file="../../Dataset/childhood/atlas/schaefer17_400_3d.RData")
lh_label <- schaefer17_400_3d$ggseg_3d[[1]]['region'][2:201,1:1]
rh_label <- schaefer17_400_3d$ggseg_3d[[2]]['region'][2:201,1:1]
label  <-rbind(lh_label, rh_label)
child <- read.csv('../../Derivatives/childhood/original_motion_1mm.csv')
child['region'] <- label
adult <- read.csv('../../Derivatives/adult/original.csv')
adult['region'] <- label
indv <- read.csv('../../Derivatives/childhood/indv_motion_1mm.csv')
indv05 <- read.csv('../../Derivatives/childhood/indv_motion_0.5mm.csv')
concat <- read.csv('../../Derivatives/childhood/original_motion_1mm.csv')
concat05 <- read.csv('../../Derivatives/childhood/original_motion_0.5mm.csv')
age_H <- read.csv("../../Derivatives/childhood/hurst_motion_1mm.csv")
age_part <- read.csv("../../Derivatives/childhood/part_motion_1mm.csv")
# Figure5A
ggseg(child, atlas = schaefer17_400, mapping = aes(fill = part),
position = "stacked") +
scale_fill_gradient(low = "white", high = "blue") + #, limits = c(0.72, 0.82)
theme_brain(text.size=16)
ggsave(filename ='Figure5Achild.eps', device = "pdf", dpi = 500)
# Figure5A
ggseg(adult, atlas = schaefer17_400, mapping = aes(fill = part),
position = "stacked") +
scale_fill_gradient(low = "white", high = "blue") + #, limits = c(0.72, 0.82)
theme_brain(text.size=16)
ggsave(filename ='Figure5Aadult.eps', device = "pdf", dpi = 500)
# Figure5A
ggseg(child, atlas = schaefer17_400, mapping = aes(fill = part),
position = "stacked") +
scale_fill_gradient(low = "white", high = "blue", limits = c(0.6, 0.82)) +
theme_brain(text.size=16)
ggsave(filename ='Figure5Achild.eps', device = "pdf", dpi = 500)
# Figure5A
ggseg(adult, atlas = schaefer17_400, mapping = aes(fill = part),
position = "stacked") +
scale_fill_gradient(low = "white", high = "blue", limits = c(0.6, 0.82)) +
theme_brain(text.size=16)
ggsave(filename ='Figure5Aadult.eps', device = "pdf", dpi = 500)
k = 3
# Figure5B
postscript('Fig5Bchild.eps')
model <- gam(child[['part']] ~ s(SArank, k=k), data = child)
pred <- predict(model, se.fit=T)
ggplot(data = child, mapping = aes(x = SArank, y = part)) +
geom_point(aes(x=SArank, color=SArank)) + scale_color_gradient(low='yellow', high='purple') +
geom_ribbon(aes(ymin=pred$fit-1.96*pred$se.fit,
ymax=pred$fit+1.96*pred$se.fit), alpha = 1, fill = 'gray') + ylim(0.6,0.82) +
geom_smooth(method="gam", formula= y~s(x, k=k))
print(summary(model))
dev.off()
k = 3
# Figure5B
postscript('Fig5Badult.eps')
model <- gam(child[['part']] ~ s(SArank, k=k), data = adult)
pred <- predict(model, se.fit=T)
ggplot(data = child, mapping = aes(x = SArank, y = part)) +
geom_point(aes(x=SArank, color=SArank)) + scale_color_gradient(low='yellow', high='purple') +
geom_ribbon(aes(ymin=pred$fit-1.96*pred$se.fit,
ymax=pred$fit+1.96*pred$se.fit), alpha = 1, fill = 'gray') + ylim(0.6,0.82) +
geom_smooth(method="gam", formula= y~s(x, k=k))
print(summary(model))
dev.off()
k = 3
# Figure5B
postscript('Fig5Bchild.eps')
model <- gam(child[['part']] ~ s(SArank, k=k), data = child)
pred <- predict(model, se.fit=T)
ggplot(data = child, mapping = aes(x = SArank, y = part)) +
geom_point(aes(x=SArank, color=SArank)) + scale_color_gradient(low='yellow', high='purple') +
geom_ribbon(aes(ymin=pred$fit-1.96*pred$se.fit,
ymax=pred$fit+1.96*pred$se.fit), alpha = 1, fill = 'gray') + ylim(0.6,0.82) +
geom_smooth(method="gam", formula= y~s(x, k=k))
print(summary(model))
dev.off()
k = 3
# Figure5B
postscript('Fig5Badult.eps')
model <- gam(adult[['part']] ~ s(SArank, k=k), data = adult)
pred <- predict(model, se.fit=T)
ggplot(data = adult, mapping = aes(x = SArank, y = part)) +
geom_point(aes(x=SArank, color=SArank)) + scale_color_gradient(low='yellow', high='purple') +
geom_ribbon(aes(ymin=pred$fit-1.96*pred$se.fit,
ymax=pred$fit+1.96*pred$se.fit), alpha = 1, fill = 'gray') + ylim(0.6,0.82) +
geom_smooth(method="gam", formula= y~s(x, k=k))
print(summary(model))
dev.off()
k = 3
# Figure5B
postscript('Fig5Bchild.eps')
model <- gam(child[['part']] ~ s(SArank, k=k), data = child)
pred <- predict(model, se.fit=T)
ggplot(data = child, mapping = aes(x = SArank, y = part)) +
geom_point(aes(x=SArank, color=SArank)) + scale_color_gradient(low='yellow', high='purple') +
geom_ribbon(aes(ymin=pred$fit-1.96*pred$se.fit,
ymax=pred$fit+1.96*pred$se.fit), alpha = 1, fill = 'gray') + ylim(0.65,0.82) +
geom_smooth(method="gam", formula= y~s(x, k=k))
print(summary(model))
dev.off()
k = 3
# Figure5B
postscript('Fig5Badult.eps')
model <- gam(adult[['part']] ~ s(SArank, k=k), data = adult)
pred <- predict(model, se.fit=T)
ggplot(data = adult, mapping = aes(x = SArank, y = part)) +
geom_point(aes(x=SArank, color=SArank)) + scale_color_gradient(low='yellow', high='purple') +
geom_ribbon(aes(ymin=pred$fit-1.96*pred$se.fit,
ymax=pred$fit+1.96*pred$se.fit), alpha = 1, fill = 'gray') + ylim(0.65,0.82) +
geom_smooth(method="gam", formula= y~s(x, k=k))
print(summary(model))
dev.off()
k = 3
# Figure5B
postscript('Fig5Bchild.eps')
model <- gam(child[['part']] ~ s(SArank, k=k), data = child)
pred <- predict(model, se.fit=T)
ggplot(data = child, mapping = aes(x = SArank, y = part)) +
geom_point(aes(x=SArank, color=SArank)) + scale_color_gradient(low='yellow', high='purple') +
geom_ribbon(aes(ymin=pred$fit-1.96*pred$se.fit,
ymax=pred$fit+1.96*pred$se.fit), alpha = 1, fill = 'gray') + ylim(0.6,0.82) +
geom_smooth(method="gam", formula= y~s(x, k=k))
print(summary(model))
dev.off()
k = 3
# Figure5B
postscript('Fig5Badult.eps')
model <- gam(adult[['part']] ~ s(SArank, k=k), data = adult)
pred <- predict(model, se.fit=T)
ggplot(data = adult, mapping = aes(x = SArank, y = part)) +
geom_point(aes(x=SArank, color=SArank)) + scale_color_gradient(low='yellow', high='purple') +
geom_ribbon(aes(ymin=pred$fit-1.96*pred$se.fit,
ymax=pred$fit+1.96*pred$se.fit), alpha = 1, fill = 'gray') + ylim(0.6,0.82) +
geom_smooth(method="gam", formula= y~s(x, k=k))
print(summary(model))
dev.off()
